---
title: "Path Analysis"
author: |
  | Deependra Dhakal
  | College of Natural Resource Management
  | Agriculture and Forestry University
  | \textit{ddhakal.rookie@gmail.com}
  | \url{https://rookie.rbind.io}
output: 
  binb::monash:
    toc: true
    keep_tex: true
    slide_level: 2
    includes:
      in_header: beamer_header_template.tex
colortheme: monashwhite
outertheme: smoothtree
innertheme: rounded
innercolortheme: rose
outercolortheme: whale
linkcolor: red
urlcolor: lightgrayd
# titlefontsize: 22pt # breaks custom \lineskip
titlepage: deepseashrimp.jpg
fontsize: 11pt
classoption: "aspectratio=169" # "compressed"
bibliography: [./../bibliographies.bib]
header-includes: 
  - \AtBeginSubsection{}
---

```{r setup, include=FALSE}
library(knitr)
require(tidyverse)
require(lavaan)
require(semPlot)

set.seed(453)
# invalidate cache when the package version changes
knitr::opts_chunk$set(tidy = FALSE, echo = FALSE, 
                  message = FALSE, warning = FALSE,
                  out.width = "45%", cache = TRUE, 
                  dev.args=list(bg=grey(0.9), pointsize=11))
options(knitr.table.format = "latex")
options(knitr.kable.NA = "", digits = 2)
options(kableExtra.latex.load_packages = FALSE)
theme_set(theme_bw())
```

# Path analysis

## Introduction

- Path analysis, alike the family of related regression models, is a linear model framework that models regression equations simultaneously with the given observed variables. It can be thought of as a special case of Structural Equation Modeling (SEM).
- Variations of SEMs:
  - Simple regression
  - Multiple regression
  - Path analysis
  - Confirmatory factor analysis
  - Measurement model (Latent - Observed)
  - Structural model (Latent - Latent)
- Fit checks for SEMs
  - Model $\chi^2$
  - RMSEA values
  - Baseline model comparison

## Example (fabricated) data

```{r soydata-preview}
# load data

soy_yield_path <- read_csv("../data/soybean_path_analysis_data.csv", show_col_types = FALSE)
name_expand_dots <- set_names(rep("...", 7), colnames(soy_yield_path))
bind_rows(mutate_all(soy_yield_path[1:3,], as.character) %>%
            add_row(tibble(!!!name_expand_dots)),
          mutate_all(soy_yield_path[(nrow(soy_yield_path)-3):nrow(soy_yield_path),], as.character)) %>% 
  knitr::kable(booktabs = TRUE, caption = "A (fabricated) data showing variables having proposed roles in yield pathway.") %>%
  kableExtra::kable_styling(font_size = 8)
```


## Conventions and symbology

- Circles are latent (unobserved) variables
- Squares are manifest (observed) variables

- Triangles can be used to interpret intercepts (part of square or circle but need to be turned on 'specifically')
- Except on specific model types (multigroup and latent growth), these are not estimated.

##

- Straight arrows are "causal" or directional
- Non-standardized solution -> these are the $b$ or slope values
- Standardized solution -> these are beta values (standardized z score)
- Curved arrows are non-directional
- Non-standardized -> covariance
- Standardized -> correlation

- All endogenous variables (have arrows coming into them) have to have error terms.
- Why is the arrow going into the variable ?
  - Because the error in the model is not explained by any other variable (otherwise it wouldn't be error).

##

```{r soybean-path-model, out.width="85%"}
# here df of the model

# (7-1)*7/2 # upto this number of parameters are estimable

# model specify

soy_path_mo1 <- '
grain_yield ~ seed_wt + pods_plants + plants + seeds_pods
seeds_pods ~~ pods_branch
pods_plants ~ branch_plant + pods_branch
'

soy_sem_mo1 <- sem(model = soy_path_mo1, data = soy_yield_path)

# summary(soy_sem_mo1, fit.measures = TRUE)

semPaths(soy_sem_mo1,
         what='std',
         whatLabels = "par", 
         layout = "circle2",
         nCharNodes=8,
         # style = "lisrel",
         # style = "ram",
         # style = "mx",
         style = "OpenMx",
         sizeMan=10,
         sizeMan2 = 5,
         edge.label.cex=1,
         label.cex = 1.6,
         residuals = FALSE,
         rotation = 3,
         fade=TRUE,
         curvePivot = FALSE,
         esize = 2.5,
         asize = 1.4,
         )

# ggsave(soy_sem_path_gg, "soy_sem_path_plot.png", device = "png", width = 8, height = 8, units = "in", dpi = 250)
```


# Bibliography

## References

